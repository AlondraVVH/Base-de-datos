DROP DATABASE IF EXISTS TravelAgenda;
CREATE DATABASE TravelAgenda;
USE TravelAgenda;

CREATE TABLE Tipos_Usuarios (
    id_tipo_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre_tipo VARCHAR(50) NOT NULL,
    descripcion TEXT,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT
);

CREATE TABLE Usuarios (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    id_tipo_usuario INT NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_tipo_usuario) REFERENCES Tipo_Usuario(id_tipo_usuario),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Ubicacion (
    id_ubicacion INT AUTO_INCREMENT PRIMARY KEY,
    ciudad VARCHAR(100) NOT NULL,
    pais VARCHAR(100) NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Aeropuertos (
    id_aeropuerto INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    codigo_iata VARCHAR(10) UNIQUE NOT NULL,
    id_ubicacion INT NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_ubicacion) REFERENCES Ubicacion(id_ubicacion),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Estados_Vuelos (
    id_estado_vuelo INT AUTO_INCREMENT PRIMARY KEY,
    estado VARCHAR(50) NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT
);

CREATE TABLE Clases_Vuelos (
    id_clase_vuelo INT AUTO_INCREMENT PRIMARY KEY,
    clase VARCHAR(50) NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT
);

CREATE TABLE Vuelos (
    id_vuelo INT AUTO_INCREMENT PRIMARY KEY,
    numero_vuelo VARCHAR(20) UNIQUE NOT NULL,
    aerolinea VARCHAR(100) NOT NULL,
    id_origen INT NOT NULL,
    id_destino INT NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_origen) REFERENCES Aeropuerto(id_aeropuerto),
    FOREIGN KEY (id_destino) REFERENCES Aeropuerto(id_aeropuerto),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Vuelos_Programados (
    id_vuelo_programado INT AUTO_INCREMENT PRIMARY KEY,
    id_vuelo INT NOT NULL,
    id_estado_vuelo INT NOT NULL,
    id_clase_vuelo INT NOT NULL,
    fecha_hora_salida DATETIME NOT NULL,
    fecha_hora_llegada DATETIME NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_vuelo) REFERENCES Vuelo(id_vuelo),
    FOREIGN KEY (id_estado_vuelo) REFERENCES Estado_Vuelo(id_estado_vuelo),
    FOREIGN KEY (id_clase_vuelo) REFERENCES Clase_Vuelo(id_clase_vuelo),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Escalas (
    id_escala INT AUTO_INCREMENT PRIMARY KEY,
    id_vuelo_programado INT NOT NULL,
    id_aeropuerto INT NOT NULL,
    fecha_hora_llegada DATETIME NOT NULL,
    fecha_hora_salida DATETIME NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_vuelo_programado) REFERENCES Vuelo_Programado(id_vuelo_programado),
    FOREIGN KEY (id_aeropuerto) REFERENCES Aeropuerto(id_aeropuerto),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Reservas (
    id_reserva INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    fecha_hora_reserva DATETIME NOT NULL,
    cantidad_pasajeros INT NOT NULL,
    costo_total DECIMAL(10,2) NOT NULL,
    estado_reserva ENUM('Pendiente', 'Confirmado', 'Cancelado') NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Reservas_Vuelos (
    id_reserva_vuelo INT AUTO_INCREMENT PRIMARY KEY,
    id_reserva INT NOT NULL,
    id_vuelo_programado INT NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_reserva) REFERENCES Reserva(id_reserva),
    FOREIGN KEY (id_vuelo_programado) REFERENCES Vuelo_Programado(id_vuelo_programado),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);

CREATE TABLE Asientos (
    id_asiento INT AUTO_INCREMENT PRIMARY KEY,
    id_reserva_vuelo INT NOT NULL,
    numero_asiento VARCHAR(10) NOT NULL,
    estado ENUM('Reservado', 'Disponible') NOT NULL,
    CREATED DATETIME DEFAULT CURRENT_TIMESTAMP,
    MODIFIED DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DELETED TINYINT(1) DEFAULT 1,
    USER_ID INT,
    FOREIGN KEY (id_reserva_vuelo) REFERENCES Reserva_Vuelo(id_reserva_vuelo),
    FOREIGN KEY (USER_ID) REFERENCES Usuario(id_usuario)
);
